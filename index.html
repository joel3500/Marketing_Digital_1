<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat avec les Responsables Marketing</title>

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins|Sofia|Trirong|Audiowide">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins&effect=fire|neon|outline|emboss|shadow-multiple">

  <!-- Ton CSS -->
  <link rel="stylesheet" href="static/style.css">

  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

  <h2> Les Responsables Marketing <br><br> GYMNASE INTELLIGENT A DOMICILE </h2>

  <!-- Bandeau image (ton CSS s‚Äôoccupe du fond) -->
  <header class="header_avec_image"></header>

  <div class="grand_cadre_du_chat">
    <main class="container">
      <!-- poster_un_chat -->
      <div class="poster_un_chat">
        <!-- IMPORTANT : action absolue pour fallback sans JS -->
        <form id="chat-form" class="chat-form" action="https://marketing-chat.onrender.com/post" method="post">
          <div class="row">
            <label for="prenom">Pr√©nom</label>
            <input type="text" id="prenom" name="prenom" placeholder="Alice" required>
          </div>
          <div class="row">
            <label for="filiaire">Fili√®re</label>
            <input type="text" id="filiaire" name="filiaire" placeholder="Arts et Lettres" required>
          </div>
          <div class="row">
            <label for="commentaire">Commentaire</label>
            <textarea id="commentaire" name="commentaire" placeholder="Coool ! c'est super d'avoir de quoi interagir avec les responsables :)" required></textarea>
          </div>
          <button id="send-btn" type="submit">Envoyer</button>
          <span id="status" class="status" aria-live="polite"></span>
        </form>
      </div>

      <hr><!-- ( La petite barre horizontale qui sert de s√©parateur ) -->

      <!-- le_chat -->
      <div class="le_chat" id="le_chat">
        <p class="empty">Aucun message pour le moment ‚Äî lance la discussion !</p>
      </div>
    </main>
  </div>
  
  <!-- Socket.IO client (si pas d√©j√† inclus plus haut) -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <script>
    // Ton backend Render
    const RENDER_BASE = "https://marketing-chat.onrender.com";

    // Connexion Socket.IO au backend Render
    const socket = io(RENDER_BASE, { 
      transports: ["websocket", "polling"] 
    });

    const form = document.getElementById('chat-form');
    const btn  = document.getElementById('send-btn');
    const st   = document.getElementById('status');
    const chat = document.getElementById('le_chat');

    // Rendu d'une ligne: Prenom (Fili√®re) : Commentaire
    function renderMessage({ prenom, filiaire, commentaire }) {
      if (!prenom || !filiaire || !commentaire) return;

      const empty = chat.querySelector(".empty");
      if (empty) empty.remove();

      const line = document.createElement("div");
      line.className = "chat-line";
      line.innerHTML = `<strong>${escapeHtml(prenom)}</strong> (<em>${escapeHtml(filiaire)}</em>) : ${escapeHtml(commentaire)}`;
      // Ajout en haut (ordre descendant)
      chat.prepend(line);
    }

    // üëâ √âcoute l'√©v√©nement envoy√© par le serveur
    socket.on("chat:new", (msg) => {
      renderMessage(msg);
    });

    // (optionnel) logs utiles
    socket.on("connect", () => console.log("[SOCKET] connect√©", socket.id));
    socket.on("connect_error", (e) => console.error("[SOCKET] erreur", e));

    // Protection simple anti-injection
    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
  </script>

  <footer>
    Projet r√©alis√© par : Rashid, Mohamed et Dolor√®s, et Joel | 2MAR210 A2025 : Marketing Digital | UQAC | Automne 2025
  </footer>
</body>
</html>

